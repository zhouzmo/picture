<mxfile host="app.diagrams.net" modified="2024-07-17T08:02:40.857Z" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.0.0 Safari/537.36" etag="pJfes3GK7GBJGMIK7hqW" version="24.6.5" type="github">
  <diagram id="C5RBs43oDa-KdzZeNtuy" name="Page-1">
    <mxGraphModel dx="729" dy="744" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="9999999999" pageHeight="999999999" math="0" shadow="0">
      <root>
        <mxCell id="WIyWlLk6GJQsqaUBKTNV-0" />
        <mxCell id="WIyWlLk6GJQsqaUBKTNV-1" parent="WIyWlLk6GJQsqaUBKTNV-0" />
        <mxCell id="puL79OhdXBKn2q62L_fg-2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="puL79OhdXBKn2q62L_fg-0" target="puL79OhdXBKn2q62L_fg-1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="puL79OhdXBKn2q62L_fg-0" value="初始化 sensor&lt;br&gt;IMP 系统&lt;br&gt;设置 isp 参数，设置 isp 参数（亮度，饱和度）" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=16;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="610" y="60" width="200" height="100" as="geometry" />
        </mxCell>
        <mxCell id="puL79OhdXBKn2q62L_fg-1" value="创建通道，提供数据" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=16;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="650" y="220" width="120" height="50" as="geometry" />
        </mxCell>
        <mxCell id="puL79OhdXBKn2q62L_fg-3" value="编码器 &lt;br&gt;码率控制器&lt;br&gt;通道属性&lt;br&gt;初始化Channel属性&lt;br&gt;注册到 group" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=16;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="590" y="310" width="270" height="130" as="geometry" />
        </mxCell>
        <mxCell id="puL79OhdXBKn2q62L_fg-4" value="/* Step.2 FrameSource init */&#xa;sample_framesource_init();&#xa;    // 创建通道，给后端模块提供数据源;设置通道的相关属性&#xa;    IMP_FrameSource_CreateChn(chn[i].index, &amp;chn[i].fs_chn_attr);&#xa;    IMP_FrameSource_SetChnAttr(chn[i].index, &amp;chn[i].fs_chn_attr);" style="text;whiteSpace=wrap;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="800" y="220" width="390" height="50" as="geometry" />
        </mxCell>
        <mxCell id="puL79OhdXBKn2q62L_fg-5" value="/* Step.1 System init */&#xa;sample_system_init();&#xa;    /* isp osd and ipu osd buffer size set */&#xa;    IMP_OSD_SetPoolSize(512*1024);&#xa;    IMP_ISP_Tuning_SetOsdPoolSize(512 * 1024);&#xa;    // 设置 sensor 基本信息&#xa;    memset(&amp;sensor_info, 0, sizeof(IMPSensorInfo));&#xa;    // 打开ISP模块&#xa;    ret = IMP_ISP_Open();&#xa;    // 添加一个sensor，用于向ISP模块提供数据源&#xa;    int IMP_ISP_AddSensor(IMPSensorInfo *pinfo);&#xa;    // 使能一个sensor&#xa;    int IMP_ISP_EnableSensor(void);&#xa;    // IMP系统初始化.&#xa;    int IMP_System_Init(void);&#xa;    // 使能ISP效果调试功能&#xa;    int IMP_ISP_EnableTuning(void);&#xa;    // 设置ISP 综合效果图片 对比度 锐度 饱和度 亮度参数 ，工作模式，正常模式或夜视模式；&#xa;    IMP_ISP_Tuning_SetContrast(128);&#xa;    IMP_ISP_Tuning_SetSharpness(128);&#xa;    IMP_ISP_Tuning_SetSaturation(128);&#xa;    IMP_ISP_Tuning_SetBrightness(128);&#xa;    ret = IMP_ISP_Tuning_SetISPRunningMode(IMPISP_RUNNING_MODE_DAY);" style="text;whiteSpace=wrap;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="120" y="10" width="530" height="310" as="geometry" />
        </mxCell>
        <mxCell id="puL79OhdXBKn2q62L_fg-6" value="&lt;div style=&quot;color: #cccccc;background-color: #1f1f1f;font-family: Consolas, &#39;Courier New&#39;, monospace;font-weight: normal;font-size: 14px;line-height: 19px;white-space: pre;&quot;&gt;&lt;div&gt;/* Step.3 Encoder init */&lt;/div&gt;&lt;div&gt;sample_encoder_init()&lt;span style=&quot;color: rgb(106, 153, 85);&quot;&gt;; &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; // 设置 编码器 码率控制器 通道属性 编码Channel属性&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; IMPEncoderAttr *enc_attr&lt;span style=&quot;color: rgb(106, 153, 85);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; IMPEncoderRcAttr *rc_attr&lt;span style=&quot;color: rgb(106, 153, 85);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; IMPFSChnAttr *imp_chn_attr_tmp&lt;span style=&quot;color: rgb(106, 153, 85);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; IMPEncoderCHNAttr channel_attr&lt;span style=&quot;color: rgb(106, 153, 85);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; ...&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; if (chn[i].&lt;span style=&quot;color: rgb(86, 156, 214);&quot;&gt;payloadType&lt;/span&gt; == PT_H264) &lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; rc_attr-&amp;gt;&lt;span style=&quot;color: rgb(86, 156, 214);&quot;&gt;attrRcMode.rcMode&lt;/span&gt; = ENC_RC_MODE_CBR&lt;span style=&quot;color: rgb(106, 153, 85);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; rc_attr-&amp;gt;&lt;span style=&quot;color: rgb(86, 156, 214);&quot;&gt;attrRcMode.attrH264Cbr.outBitRate&lt;/span&gt; = BITRATE_720P_Kbs&lt;span style=&quot;color: rgb(106, 153, 85);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; rc_attr-&amp;gt;&lt;span style=&quot;color: rgb(86, 156, 214);&quot;&gt;attrRcMode.attrH264Cbr.maxQp&lt;/span&gt; = 45&lt;span style=&quot;color: rgb(106, 153, 85);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; // 创建编码Channel,注册编码Channel到Group&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: rgb(86, 156, 214);&quot;&gt;ret&lt;/span&gt; = IMP_Encoder_CreateChn(chnNum, &amp;amp;channel_attr)&lt;span style=&quot;color: rgb(106, 153, 85);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: rgb(86, 156, 214);&quot;&gt;ret&lt;/span&gt; = IMP_Encoder_RegisterChn(chn[i].index, chnNum)&lt;span style=&quot;color: rgb(106, 153, 85);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="870" y="310" width="560" height="330" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
